<% content_for :head do -%>
  <%= javascript_include_tag 'flot/jquery.flot' -%>
  <% javascript_tag do -%>
    $(function() {
    var d = <%= @pivots.map {|p| p.hourly_scores.since(30.days.ago).map {|sa| [ sa.created_at.to_i * 1000, sa.score ]} }.to_json %>;
      $.plot($('#graph'), d, { 
      xaxis: { mode: 'time' } ,
      colors: <%= graph_colors.to_json %>,
      grid: { color: '#666666', tickColor: '#333333', backgroundColor: '#000000' }
      });
    });
  <% end -%>
<% end -%>

<style>
  <% @pivots.each_with_index do |pivot, index| -%>
    .trend-<%= pivot.trend_id %>, a.trend-<%= pivot.trend_id %> {
      color: <%= color_for_index(index) %>
    }
  <% end -%>
</style>

<div class="span-16">
  <div id="sidebar">
<h3>People feel most <span class="emotion"><%=h @emotion.name %></span> because of</h3> 
<ul class="scoreboard">
  <% @pivots.each_with_index do |pivot, index| -%>
    <li>
      <span class="score"><%= pivot.formatted_score %></span>
      <span class="trend"><%= link_to pivot.trend.name, pivot.trend, :class => "trend-#{pivot.trend_id}" %></span>
    </li>
  <% end -%>
</ul>
  <div id="graph" style="width:600px;height:300px;"></div>
  </div>
</div>

<div class="span-8 last">
  <div class="span-8 last">
    <div id="timeline" class="timeline">
      <h5>Loading...</h5>
    </div>
  </div>
</div>

<%= periodically_call_remote :url => statuses_emotion_path(@emotion), :method => :get, :update => 'timeline', :frequency => '5' %>

