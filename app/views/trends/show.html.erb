<% content_for :head do -%>
  <%= javascript_include_tag 'flot/jquery.flot' -%>
  <% javascript_tag do -%>
    $(function() {
    var d = <%= @pivots.map {|p| p.hourly_scores.since(30.days.ago).map {|sa| [ sa.created_at.to_i * 1000, sa.score ]} }.to_json %>;
      $.plot($('#graph'), d, { 
      xaxis: { mode: 'time' } ,
      colors: <%= graph_colors.to_json %>,
      grid: { color: '#666666', tickColor: '#333333', backgroundColor: '#000000' }
      });
    });
  <% end -%>
<% end -%>

<style>
  <% @pivots.each_with_index do |pivot, index| -%>
    .emotion-<%= pivot.emotion_id %>, a.emotion-<%= pivot.emotion_id%> {
      color: <%= color_for_index(index) %>
    }
  <% end -%>
</style>

<div class="span-16">
<h3>What do people feel because of <span class="trend"><%=h @trend.name %>?</h3> 
<ul class="scoreboard">
  <% @pivots.each_with_index do |pivot, index| -%>
    <li>
      <span class="score"><%= pivot.formatted_score %></span>
      <span class="emotion"><%= link_to pivot.emotion.name, pivot.emotion, :class => "emotion-#{pivot.emotion_id}"%></span>
    </li>
  <% end -%>
</ul>
  <div id="graph" style="width:600px;height:300px;"></div>
</div>

<div class="span-8 last">
  <div id="timeline" class="timeline">
    <h5>Loading...</h5>
  </div>
</div>

<%= periodically_call_remote :url => statuses_trend_path(@trend), :method => :get, :update => 'timeline', :frequency => '5' %>
